<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Index</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@500;700&display=swap" rel="stylesheet" />

  <style>
    body {
      font-family: 'Quicksand', sans-serif;
      background: linear-gradient(180deg, #fdf0d5, #fbe1b7);
    }

    .input-box {
      background-color: #fff;
      color: #000;
    }

    .input-icon {
      position: absolute;
      left: 1rem;
      top: 50%;
      transform: translateY(-50%);
      color: #a0aec0;
    }

    .input-field {
      padding-left: 2.5rem;
    }

    .mic-button.listening {
      animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
      0% {
        box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7);
      }

      70% {
        box-shadow: 0 0 0 25px rgba(239, 68, 68, 0);
      }
    }
  </style>
</head>

<body class="flex items-center justify-center min-h-screen px-6">
  <div class="w-full max-w-sm bg-white/60 backdrop-blur-md rounded-3xl shadow-xl p-8 space-y-6">
    <div class="text-center">
      <p class="text-orange-500 font-semibold">Voice-Control-UI!</p>
    </div>
    <h2 class="text-2xl font-bold text-gray-800 text-center">Login</h2>

    <form id="login-form" class="space-y-4">
      <div class="relative">
        <span class="input-icon">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path d="M16 12a4 4 0 10-8 0 4 4 0 008 0z" />
          </svg>
        </span>
        <input id="email-input" type="email" placeholder="Email" required
          class="w-full rounded-md input-box py-3 input-field focus:outline-none" />
      </div>
      <div class="relative">
        <span class="input-icon">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2h-1" />
          </svg>
        </span>
        <input id="password-input" type="password" placeholder="Password" required
          class="w-full rounded-md input-box py-3 input-field focus:outline-none" />
      </div>

      <button id="submit-button" type="submit"
        class="w-full bg-yellow-400 hover:bg-yellow-500 text-black font-bold py-3 rounded-full shadow">
        Sign In
      </button>
    </form>
  </div>

  <!-- Voice UI -->
  <div class="fixed bottom-6 right-6 flex flex-col items-end space-y-4">
    <div id="status-display" class="bg-black/60 text-white p-4 rounded-lg opacity-0 transition-opacity">
      <p id="status" class="font-semibold">Listening...</p>
      <p id="command-output" class="text-pink-400 text-sm mt-1">-</p>
    </div>
    <button id="mic-button"
      class="mic-button bg-red-500 hover:bg-red-600 text-white w-16 h-16 rounded-full shadow-lg flex items-center justify-center">
      <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
        <path d="M7 4a3 3 0 016 0v6a3 3 0 11-6 0V4z" />
      </svg>
    </button>
  </div>

  <script>
    const micButton = document.getElementById('mic-button');
    const statusEl = document.getElementById('status');
    const commandOutput = document.getElementById('command-output');
    const statusBox = document.getElementById('status-display');
    const emailInput = document.getElementById('email-input');
    const passwordInput = document.getElementById('password-input');
    const loginForm = document.getElementById('login-form');

    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    let recognition, isListening = false;

    if (SpeechRecognition) {
      recognition = new SpeechRecognition();
      recognition.continuous = false;
      recognition.lang = 'en-US';

      recognition.onstart = () => {
        isListening = true;
        micButton.classList.add('listening');
        statusBox.classList.remove('opacity-0');
        statusEl.textContent = 'Listening...';
      };

      recognition.onend = () => {
        isListening = false;
        micButton.classList.remove('listening');
        statusBox.classList.add('opacity-0');
      };

      recognition.onresult = (e) => {
        const command = e.results[0][0].transcript.trim().toLowerCase();
        commandOutput.textContent = `"${command}"`;

        if (command.includes('email')) {
          const emailText = command.replace(/type|in email|email is|email/g, '').trim();
          emailInput.value = emailText;
        } else if (command.includes('password')) {
          const passText = command.replace(/type|in password|password is|password/g, '').trim();
          passwordInput.value = passText;
        } else if (command.includes('login') || command.includes('sign in')) {
          loginForm.requestSubmit();
        } else if (command.includes('go to home') || command.includes('open home')) {
          window.location.href = 'home.html';
        } else if (command.includes('calendar') || command.includes('go to calendar')) {
          window.location.href = 'calendar.html';
        } else if (command.includes("i feel") || command.includes("my mood is")) {
          const mood = command.replace(/(i feel|my mood is)/g, "").trim();

          fetch('/api/mood', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({ mood })
          })
            .then(res => res.json())
            .then(data => {
              if (data.success) {
                commandOutput.textContent += " (Mood saved)";
              } else {
                alert("⚠️ Failed to save mood");
              }
            })
            .catch(err => {
              console.error("❌ Mood save error:", err);
              alert("Server error while saving mood.");
            });
        }
      };

      micButton.addEventListener('click', () => {
        isListening ? recognition.stop() : recognition.start();
      });
    } else {
      micButton.style.display = 'none';
      alert("Speech Recognition not supported in this browser. Please use Google Chrome.");
    }

    loginForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const email = emailInput.value.trim().toLowerCase();
      const password = passwordInput.value.trim();

      if (email === "hesha@gmail.com" && password === "12345") {
        window.location.href = 'home.html';
      } else {
        alert("Access denied. Invalid credentials.");
      }
    });
    fetch('/api/login', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ username, password })
    })
      .then(res => res.json())
      .then(response => {
        if (response.success) {
          localStorage.setItem("userId", response.userId);
          // redirect to home page or dashboard
        } else {
          alert("Login failed");
        }
      });
    socket.on('execute-action', (action) => {
      if (action.type === 'REDIRECT') {
        window.location.href = action.payload.url;
      } else if (action.type === 'GO_BACK') {
        window.history.back();
      }
    });

  </script>
</body>

</html>